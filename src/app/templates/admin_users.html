{% extends 'base.html' %}

{% block header %}
{% endblock %}

{% block content %}
  <div class="container-fluid">
    <div class="row p-3">
      <div class="col">

        <h2>Users</h2>

        <table class="table table-hover">
          <thead>
            <tr>
              <th scope="col">ID</th>
              <th scope="col">Role</th>
              <th scope="col">Login</th>
              <th scope="col">Password</th>
              <th scope="col"></th>
            </tr>
          </thead>
          <tbody>
          {% for user in User.query.order_by(User.id) %}
          <tr>
            <td scope="row">
              {{ user.id }}
              </td>
            <td>
              {% if user.is_admin() %}
              <span class="badge bg-danger">Admin</span>
              {% elif user.is_operator() %}
              <span class="badge bg-warning">Operator</span> of {{ user.operator.name }}
              {% elif user.is_crew() %}
              <span class="badge bg-primary">Crew</span> of {{ user.employer.name }}
              {% else %}
              <span class="badge bg-secondary">User</span>
              {% endif %}
            </td>
            <td>
              {{ user.login }}
            </td>
            <td>
            {% if user.password == None %}
              <span class="badge bg-secondary">Disabled</span>
            {% else %}
              {{ user.password }}
            {% endif %}
            </td>
            <td align="right" width="1%" nowrap>
              <a class="btn btn-warning" href="{{ url_for('admin_users_modify', redir=url_for('admin_users'), id=user.id) }}">Modify</a>
              <a class="btn btn-danger" href="{{ url_for('admin_users_delete', redir=url_for('admin_users'), id=user.id) }}">Delete</a>
            </td>
          </tr>
          {% endfor %}
          </tbody>
        </table>

        <h2>Add new user</h2>

        <span>
          <script type="text/javascript">
            $( document ).ready(function(){
            $("#operator_name").hide();
            $("#operator_name").prop('required', false);
            $("#employer_id").hide();
            $("#employer_id").prop('required', false);
            if ($('#role').val() == 'operator'){
                $("#operator_name").show();
                $("#operator_name").prop('required', true);
            }else if ($('#role').val() == 'crew'){
                $("#employer_id").show();
                $("#employer_id").prop('required', true);
            }

            $('#role').on('change', function() {
              $("#operator_name").hide();
              $("#operator_name").prop('required', false);
              $("#employer_id").hide();
              $("#employer_id").prop('required', false);
              if (this.value == 'operator'){
                $("#operator_name").show();
                $("#operator_name").prop('required', true);
              }else if (this.value == 'crew'){
                $("#employer_id").show();
                $("#employer_id").prop('required', true);
              }
            })
            });
          </script>
          <form action="{{ url_for('admin_users_add') }}" method="POST" class="g-3">
            <label for="role" class="form-label">Role: </label>
            <select class="form-select" id="role" name="role" required>
              <option value="" selected>Select Role</option>
              <option value="admin">Admin</option>
              <option value="operator">Operator</option>
              <option value="crew">Crew</option>
              <option value="user">User</option>
            </select>
            <input type="text" class="form-control" name="login" placeholder="Login" required>
            <input type="password" class="form-control" name="password" placeholder="Password" required>
            <input type="text" class="form-control" id="operator_name" name="operator_name" placeholder="Operator Name">
            <select class="form-select" id="employer_id" name="employer_id">
              <option value="" selected>Select Employer</option>
              {% for operator in Operator.query.order_by(Operator.name) %}
                <option value="{{ operator.id }}">{{ operator.name }}</option>
              {% endfor %}
            </select>
            <input type="hidden" name="redir" value="{{ url_for('admin_users') }}">
            <button type="submit" class="col-auto btn btn-primary">Add User</button>
          </form>
        </span>
    </div>
  </div>
</div>
{% endblock %}
